/* device.js v0.0.3 - 10/14/2013
   http://
   Copyright (c) 2013 Javi Jimenez Villar - Licensed MIT */
window.Device={addEvent:function(a,b,c){return a.addEventListener?a.addEventListener(b,c,!1):a.attachEvent?a.attachEvent("on"+b,c):a["on"+b]=c},removeEvent:function(a,b,c){return a.removeEventListener?a.removeEventListener(b,c,!1):a.detachEvent?a.detachEvent("on"+b,c):a["on"+b]=null}},Device.Alarm=function(){var a,b,c,d,e,f,g,h;return a="alarm",navigator.alarms=navigator.alarms||navigator.mozAlarms,f=(null!=(g=navigator.alarms)?g.addEventListener:void 0)||navigator.mozSetMessageHandler,c=function(a,b){var c;return c=navigator.alarms.all(),h(c,a,b)},b=function(a,b,c,d,e){var f,g;return g=b?"respectTimezone":"ignoreTimezone",f=navigator.alarms.add(a,g,c),h(f,d,e)},e=function(a,b){var c;return c=navigator.alarms.remove(a),h(c,b,errorr)},d=function(b){return f?f(a,b):void 0},h=function(a,b,c){return null!=a&&(a.onsuccess=b),null!=a&&(a.onerror=c),a},{add:b,remove:e,all:c,event:d}}(Device),Device.Audio=function(){var a,b,c,d,e;return c=document.createElement("audio"),e=document.createElement("audio"),a=function(a){return a?(d(e,a),c.addEventListener("ended",function(){return this.currentTime=0},!1)):c.pause()},b=function(a){return d(e,a)},d=function(a,b){return a.setAttribute("src",b),a.play()},{background:a,play:b}}(),Device.Battery=function(a){var b,c,d,e,f,g,h,i,j;return b={CHARGING:"chargingchange",CHARGING_TIME:"chargingtimechange",DISCHARGING_TIME:"dischargingtimechange",LEVEL:"levelchange"},navigator.battery=navigator.battery||navigator.webkitBattery||navigator.mozBattery,g=function(){return null!=navigator.battery?j():i("Device no available")},c=function(a){return h(b.CHARGING,a)},d=function(a){return h(b.CHARGING_TIME,a)},e=function(a){return h(b.DISCHARGING_TIME,a)},f=function(a){return h(b.LEVEL,a)},h=function(b,c){return a.addEvent(navigator.battery,b,function(){return null!=c?c.call(c,j()):void 0})},j=function(){return{level:Math.floor(100*navigator.battery.level),charging:navigator.battery.charging,chargingTime:navigator.battery.chargingTime,dischargingTime:navigator.battery.chargingTime}},i=function(a){return console.error("Device.Battery [ERROR] - ",a)},{status:g,onCharging:c,onChargingTime:d,onDischargingTime:e,onLevel:f}}(Device),Device.Camera=function(){var a,b,c;return navigator.getUserMedia=navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia||navigator.msGetUserMedia,c=null,a=function(a,d){return null!=navigator.getUserMedia?c=navigator.getUserMedia(a,function(a){return null!=d?d.call(d,a):void 0},function(a){return b(a)}):b("Device no available")},b=function(a){return console.error("Device.Camera [ERROR] - ",a)},{get:a}}(Device),Device.Connection=function(a){var b,c,d;return b={ONLINE:"online",OFFLINE:"offline"},d=function(c){return a.addEvent(window,b.ONLINE,c)},c=function(c){return a.addEvent(window,b.OFFLINE,c)},{online:d,offline:c}}(Device),Device.Contact=function(){var a,b,c,d,e;return e=navigator.contacts||null,a=function(a){var b;return b=e.create(a),b.save(),this},d=function(a,b,c){return e.find(b,function(){},function(){},c),this},c=function(){return this},b=function(){return e.find(properties,function(){},function(){},options),this}}(Device),Device.DB=function(){var a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p;return a=null,d=function(b,c,d,e){var f,g,h,i;if(a=openDatabase(b,c,b,d)){if(h=e.length,!h)return;for(g=0,i=[];h>g;)f=e[g],n(f),j(f.name,f.fields),i.push(g++);return i}throw new Error("[ERROR] Device.DB: DB unnecesible")},f=function(a,b,d){var e;return e=b?" WHERE "+i(b,"AND"):"",c("SELECT * FROM "+a+e,function(a){var b,c,e;for(e=[],b=0,c=a.rows.length;c>b;)e.push(a.rows.item(b)),b++;return h(d,e)})},e=function(a,b){var c,d;if("object"===p(b))return l(a,b);d=[];for(c in b)d.push(l(a,b[c]));return d},g=function(a,b,d){var e;return e="UPDATE "+a+" SET "+i(b,","),d&&(e+=" WHERE "+i(d,"AND")),c(e)},b=function(a,b){var d;return d=b?" WHERE "+i(b,"AND"):"",c("DELETE FROM "+a+d+";")},c=function(b,c){return a.transaction(function(a){return a.executeSql(b,[],function(a,b){return h(c,b)},function(a){return a.executedQuery=b,o.apply(null,arguments)})})},j=function(a,b){var d,e;e="";for(d in b)m(b,d)&&(e&&(e+=", "),e+=d+" "+b[d]);return c("CREATE TABLE IF NOT EXISTS "+a+" ("+e+");")},n=function(a){return a.drop===!0?k(a.name):void 0},k=function(a){return c("DROP TABLE IF EXISTS "+a)},i=function(a,b){var c,d,e;d="";for(c in a)m(a,c)&&(e=a[c],d&&(d+=" "+b+" "),d+=c+"=",d+=isNaN(e)?'"'+e+'"':e);return d},h=function(a,b){return"function"===p(a)?setTimeout(a,100,b):void 0},l=function(a,b){var d,e,f,g;e="",g="";for(d in b)m(b,d)&&(f=b[d],e+=e?", "+d:d,g&&(g+=", "),g+=isNaN(f)||""===f?'"'+f+'"':f);return c("INSERT INTO "+a+" ("+e+") VALUES ("+g+")")},o=function(a,b){throw new Error("[ERROR] Device.DB "+b.code+": "+b.message+" \n Executed query: "+a.executedQuery)},p=function(a){return Object.prototype.toString.call(a).match(/\s([a-z|A-Z]+)/)[1].toLowerCase()},m=function(a,b){return Object.prototype.hasOwnProperty.call(a,b)},{init:d,select:f,insert:e,update:g,drop:b,execute:c}}(Device),Device.FullScreen=function(){var a,b,c;return b=function(a){return("function"==typeof a.requestFullscreen?a.requestFullscreen():void 0)||("function"==typeof a.webkitRequestFullScreen?a.webkitRequestFullScreen():void 0)||("function"==typeof a.requestFullScreen?a.requestFullScreen():void 0)||("function"==typeof a.mozRequestFullScreen?a.mozRequestFullScreen():void 0)},a=function(a){return null==a&&(a=document),("function"==typeof a.cancelFullScreen?a.cancelFullScreen():void 0)||("function"==typeof a.webkitCancelFullScreen?a.webkitCancelFullScreen():void 0)||("function"==typeof a.mozCancelFullScreen?a.mozCancelFullScreen():void 0)||("function"==typeof a.exitFullscreen?a.exitFullscreen():void 0)},c=function(a){return null==a&&(a=document),a.fullScreen||a.webkitIsFullScreen||a.mozFullScreen},{enable:b,cancel:a,enabled:c}}(),Device.Gps=function(){var a,b,c,d,e,f,g,h,i,j,k;return j=null,k=null,a={success:null,error:null},b={enableHighAccuracy:!1,timeout:1e4,maximumAge:6e4},c=function(a,b,c){return i()?navigator.geolocation.getCurrentPosition(function(b){return g(a,b)},function(a){return b.call(b,a)},c):void 0},f=function(a,b,c){return i()?k=navigator.geolocation.watchPosition(function(b){return g(a,b)},function(a){return b.call(b,a)},c):void 0},g=function(a,b){return j=b.coords,j.accuracy=Math.round(j.accuracy),j.altitude=Math.round(j.altitude),a.call(a.call,j)},d=function(){return j},e=function(){return h()},i=function(){return navigator.geolocation?(h(),!0):(console.error("Device.Gps [ERROR]: navigator.geolocation is innacesible."),!1)},h=function(){return j=null,k?(navigator.geolocation.clearWatch(k),k=null):void 0},{get:c,watch:f,position:d,stop:e}}(Device),Device.Notification=function(){var a,b,c,d;return a=function(a,b,c,d){return navigator.notification.alert(a,b,c,d)},c=function(a,b,c,d){return navigator.notification.confirm(a,b,c,d)},b=function(a){return navigator.notification.beep(a)},d=function(a){return navigator.notification.vibrate(a)},{alert:a,confirm:c,beep:b,vibrate:d}}(),Device.Orientation=function(a){var b,c,d,e;return b={ORIENTATION:"deviceorientation",MOTION:"devicemotion",COMPASS_CALIBRATION:"compassneedscalibration"},window.Orientation=window.DeviceOrientationEvent||window.OrientationEvent,window.Motion=window.DeviceMotionEvent,c=function(c){return a.addEvent(window,b.ORIENTATION,function(a){var b,d,e,f,g,h;return a.webkitCompassHeading&&(e=a.webkitCompassHeading+window.orientation),window.DeviceOrientationEvent?(f=a.gamma,g=a.beta,h=null,d=a.alpha):window.OrientationEvent&&(f=90*a.x,g=-90*a.y,h=a.z,d=null),b={x:Math.round(f),y:Math.round(g),z:h,direction:Math.round(d),heading:e},c.call(this,b)})},d=function(c){return a.addEvent(window,b.MOTION,function(a){var b,d;return b=a.accelerationIncludingGravity,b=a.acceleration,d={x:b.x.toFixed(2),y:b.y.toFixed(2),z:b.z.toFixed(2)},c.call(this,d)})},e=function(c){return a.addEvent(window,b.COMPASS_CALIBRATION,c)},{change:c,motion:d,onNeedsCalibration:e}}(Device),Device.Page=function(a){var b,c,d,e,f;return document.visibilityState=document.visibilityState||document.webkitVisibilityState,document.hidden=document.hidden||document.webkitHidden,f={hidden:null,visible:null},d=function(){return{hidden:document.hidden,state:document.visibilityState}},b=function(a){return f.hidden=a},e=function(a){return f.visible=a},c=function(){var b;return b=document.webkitVisibilityState?"webkitvisibilitychange":"visibilitychange",a.addEvent(document,b,function(){var a;return null!=(a=f[document.visibilityState])?a.call(f[document.visibilityState]):void 0})}(),{state:d,hide:b,visible:e}}(Device),Device.Storage=function(){var a,b,c,d,e,f,g,h;return a={PERSISTENT:"localStorage",SESSION:"sessionStorage"},b=function(b,c){return f(a.PERSISTENT,b,c)},c=function(b,c){return f(a.SESSION,b,c)},f=function(a,b,c){return a=window[a],b?c?h(a,b,c):null===c?g(a,b):e(a,b):d(a)},h=function(a,b,c){return a.setItem(b,JSON.stringify(c))},g=function(a,b){return a.removeItem(b)},d=function(a){return a.clear()},e=function(a,b){return JSON.parse(a.getItem(b))},{local:b,session:c}}();